<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>GPX Time Slider Map</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Leaflet-GPX -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.7.0/gpx.min.js"></script>

<style>
  #map { height: 90vh; }
  #slider-container {
    width: 80%;
    margin: 10px auto;
  }
</style>

</head>
<body>

<div id="map"></div>

<div id="slider-container">
  <input id="timeSlider" type="range" min="0" max="100" value="0" style="width:100%;">
  <div id="timestamp" style="text-align:center; margin-top:5px;"></div>
</div>

<script>
// --- Change this to your actual GPX file path in the repo ---
const GPX_URL = "/track.gpx"; 

// Map
const map = L.map('map');

// Load GPX
let timestamps = [];
let coords = [];

new L.GPX(GPX_URL, {
    async: true,
    marker_options: { startIconUrl: null, endIconUrl: null, shadowUrl: null },
})
.on('loaded', function(e) {
    map.fitBounds(e.target.getBounds());
})
.on('addpoint', function(e) {
    const lat = e.point.latlng.lat;
    const lon = e.point.latlng.lng;
    const time = e.point.time;

    if (time) {
        coords.push([lat, lon]);
        timestamps.push(new Date(time));
    }

    slider.max = coords.length - 1;
})
.addTo(map);

// Slider + moving marker
let slider = document.getElementById("timeSlider");
let tsLabel = document.getElementById("timestamp");
let marker = null;

slider.addEventListener("input", () => {
    const i = parseInt(slider.value);
    if (!coords[i]) return;

    if (marker === null) {
        marker = L.marker(coords[i]).addTo(map);
    } else {
        marker.setLatLng(coords[i]);
    }

    tsLabel.textContent = timestamps[i] ? timestamps[i].toISOString() : "";
});
</script>

</body>
</html>
