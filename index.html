<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Time Slider Map with Track Line</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Leaflet PolylineDecorator for arrows -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-polylinedecorator/1.7.0/leaflet.polylineDecorator.min.js"></script>

<style>
  #map { height: 90vh; }
  #slider-container {
    width: 80%;
    margin: 10px auto;
  }
</style>

</head>
<body>

<div id="map"></div>

<div id="slider-container">
  <input id="timeSlider" type="range" min="0" max="100" value="0" style="width:100%;">
  <div id="timestamp" style="text-align:center; margin-top:5px;"></div>
</div>

<script>
// --- Change this to your actual text file URL ---
const TXT_URL = "https://wiznerd1.github.io/Japan2025.github.io/location_log.txt"; 

// Map
const map = L.map('map').setView([1.298, 103.776], 13);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let timestamps = [];
let coords = [];
let marker = null;
let slider = document.getElementById("timeSlider");
let tsLabel = document.getElementById("timestamp");
let polyline = null;
let arrows = null;

// Fetch and parse the text file
fetch(TXT_URL)
    .then(response => response.text())
    .then(text => {
        const lines = text.split("\n");
        lines.forEach(line => {
            line = line.trim();
            if (!line) return;
            const parts = line.split(": ");
            if (parts.length !== 2) return;
            const datetimeStr = parts[0];
            const coordStr = parts[1];
            const [latStr, lonStr] = coordStr.split(", ");
            const lat = parseFloat(latStr);
            const lon = parseFloat(lonStr);
            const time = new Date(datetimeStr);

            coords.push([lat, lon]);
            timestamps.push(time);
        });

        // Fit map to all points
        if (coords.length > 0) {
            const bounds = L.latLngBounds(coords);
            map.fitBounds(bounds);

            // Draw polyline
            polyline = L.polyline(coords, {color: 'blue', weight: 3}).addTo(map);

            // Add arrows along the polyline
            arrows = L.polylineDecorator(polyline, {
                patterns: [
                    {offset: '5%', repeat: '10%', symbol: L.Symbol.arrowHead({pixelSize: 8, polygon: false, pathOptions: {stroke: true, color: 'red'}})}
                ]
            }).addTo(map);
        }

        slider.max = coords.length - 1;
    });

// Slider + moving marker
slider.addEventListener("input", () => {
    const i = parseInt(slider.value);
    if (!coords[i]) return;

    if (marker === null) {
        marker = L.marker(coords[i]).addTo(map);
    } else {
        marker.setLatLng(coords[i]);
    }

    tsLabel.textContent = timestamps[i] ? timestamps[i].toISOString() : "";
});
</script>

</body>
</html>
